# 資料庫變更日誌 (Database Changelog)

本文件記錄了為支援新版動物園管理系統功能，對原始 `zoo.backup` 資料庫所做的所有變更。

## 1. 資料庫結構變更 (Schema Changes)

### 新增資料表 (New Tables)
*   **`employee_skills` (員工專業證照表)**:
    *   用於儲存員工擁有的專業技能證照 (例如: 食肉動物照護、爬蟲類照護)。
    *   此表取代了原有的 `animal_schedule` 功能，提供更靈活的權限管理。
*   **`task` (工作項目表)**:
    *   新增工作項目 (日常照護)，最終編號為 `T006`。

### 修改資料表 (Modified Tables)
*   **`employee` (員工表)**:
    *   新增 `role` 欄位 (VARCHAR): 用於區分系統角色 ('Admin' 管理員 / 'User' 一般員工)。
*   **`animal` (動物表)**:
    *   新增 `required_skill` 欄位 (VARCHAR): 指定照顧該動物所需的專業證照 (例如: 獅子需要 'Carnivore' 證照)。
*   **`employee_shift` (員工班表)**:
    *   新增 `a_id` 欄位 (VARCHAR, FK): 連結該班次負責的特定動物 (Responsible Animal)。

### 移除資料表 (Removed Tables)
*   **`animal_schedule`**: 已廢棄，改用新的「證照/班表」雙重驗證邏輯。

## 2. 資料修正與更新 (Data Fixes & Updates)

### 錯誤修復 (Bug Fixes)
*   **修復負庫存問題**: 為所有飼料注入了初始的「進貨 (Purchase)」紀錄 (5000kg)，解決因缺乏歷史資料導致的負庫存顯示。
*   **修復管理員登入**: 將員工 `E001` (Admin) 的狀態從 'inactive' 更新為 'active'，以允許登入系統。

### [Final] - 2025-12-02
-   **資料優化 (Data Refinement)**:
    -   重新分類動物證照需求 (獅子/老虎=肉食證照，無尾熊/熊貓=無門檻)。
    -   重置展示用員工技能 (E005 無任何證照)。
    -   生成 E003, E004, E005 的專屬班表 (一人負責一隻動物)。
-   **程式優化 (Code Refinement)**:
    -   優化 `add_feeding_record` 邏輯：引入 `Decimal` 進行精確數值運算，防止浮點誤差，並增加正值檢核。
    -   重構 API：移除舊版 `add_feeding` 方法，全面改用 `add_feeding_record`，消除冗餘代碼。
-   **文件更新 (Documentation)**:
    -   於 README.md 新增「展示指南 (Demo Guide)」。
    -   新增「混合式資料庫架構」說明。
-   **專案清理 (Cleanup)**:
    -   歸檔舊的腳本與備份檔。
    -   從正式部署中移除 `scripts/` 目錄。

### [T006] - 2025-12-01
### 展示用資料 (Demo Data)
*   **資料整併與重編號**:
    *   將所有 `T004` (體重測量) 的班表合併至日常照護。
    *   將重複的環境消毒工作 (`T003`, `T005`, `T008`) 合併為單一 `T003`。
    *   **全面重編號**:
        *   `T001`: 籠舍清潔
        *   `T002`: 用藥紀錄
        *   `T003`: 環境消毒
        *   `T004`: 特殊訓練
        *   `T005`: 健康檢查
        *   `T006`: 日常照護
*   **超級班表**: 為 `E003`, `E004`, `E005` 指派了今日全天 (24小時) 的班表，方便展示。
*   **隨機分派**: 為現有的 300+ 筆歷史班表隨機指派了負責動物 (僅限照護、醫療等相關工作)，讓報表更豐富。
*   **證照資料**: 授予 `E001`, `E003`, `E004` 'Carnivore' (食肉) 與 'Reptile' (爬蟲) 證照。
*   **對照組設定**: 保留 `E006` (菜鳥) 無任何證照，以展示權限拒絕功能。

## 3. 本次更新啟用的系統功能
*   **角色權限控管 (RBAC)**: 區分管理員與一般使用者的操作介面。
*   **嚴格權限驗證系統**:
    *   **班表檢查**: 員工只能在值班時間、對負責的動物進行操作。
    *   **證照檢查**: 員工必須持有該動物要求的特定證照 (例如: 獅子需食肉動物證照) 才能操作。
*   **庫存管理**: 精確追蹤進貨與餵食消耗。
