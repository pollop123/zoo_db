# 功能展示指南

本文件提供展示動物園管理系統時的測試參數與建議流程。

---

## 啟動系統

```bash
# 1. 進入專案目錄
cd ~/Desktop/db_final

# 2. 啟動虛擬環境
source venv/bin/activate

# 3. 確認 PostgreSQL 和 MongoDB 已啟動

# 4. 啟動 Server (終端機 1)
python3 server.py

# 5. 啟動 Client (終端機 2)
python3 client.py
```

---

## 登入系統

- **所有帳號預設密碼：`zoo123`**
- 忘記密碼？在登入畫面輸入 `f` 可查詢任意員工密碼
- 任何輸入框輸入 `b` 可返回上一頁

---

## 帳號速查表

### Admin 帳號
| 員工 ID | 姓名 | 證照 |
|---------|------|------|
| **E001** | 郭雅惠 | Endangered, Carnivore |

### User 帳號
| 員工 ID | 姓名 | 證照 | 適合展示 |
|---------|------|------|----------|
| **E003** | 李建宏 | Carnivore, Penguin | 餵食猛獸/企鵝 |
| **E004** | 江俊豪 | Carnivore, Endangered | 照顧珍稀動物 |
| **E005** | 黃慧玲 | Endangered | 照顧珍稀動物 |
| **E002** | 林佳穎 | Penguin | 測試權限不足 |

> User 只能操作**今日值班且有證照的動物**，系統會自動顯示可選動物清單。

---

## User 功能展示 (使用 E003 登入)

| 功能 | 操作步驟 | 說明 |
|------|---------|------|
| **1. 新增餵食** | 選擇動物 → 選擇飼料 (只顯示該動物可吃的) → 輸入數量 | 庫存自動扣除，超過歷史平均會警告 |
| **2. 新增身體資訊** | 選擇動物 → 輸入體重 → 選擇狀態 | 體重異常會警告，需確認才能儲存 |
| **3. 查詢班表** | 直接查詢 | 顯示今日負責的動物清單 |
| **4. 修正自己紀錄** | 選擇資料表 → 選擇動物 → 選擇紀錄 → 輸入新值 | 修正會記錄到稽核日誌 |
| **5. 修改密碼** | 輸入舊密碼 → 輸入新密碼兩次 | 密碼會加密儲存 |
| **6. 我的修正紀錄** | 直接查詢 | 查看自己被標記為冒失的紀錄 |

### 展示輸入警告功能
```
新增身體資訊 → 選擇動物 → 輸入異常體重 (如 9999)
→ 系統警告「與上次差異過大」→ 選擇 N 取消
```

---

## Admin 功能展示 (使用 E001 登入)

| 功能 | 操作步驟 | 說明 |
|------|---------|------|
| **1. 稽核日誌** | 直接查詢 | 顯示所有修正紀錄 (MongoDB) |
| **2. 健康監控** | 進入子選單 | 見下方詳細說明 |
| **3. 庫存管理** | 選擇報表/進貨 | 進貨：選擇飼料 → 輸入數量 |
| **4. 指派工作** | 選擇員工 → 選擇工作 → 選擇動物 | 自動檢查證照 |
| **5. 修正紀錄** | 選擇資料表 → 選擇動物 → 選擇紀錄 | 可修正任何人的紀錄 |
| **6. 冒失鬼名單** | 直接查詢 | 顯示資料被修正的員工統計 |
| **7. 員工管理** | 進入子選單 | 新增/停用員工、管理證照 |
| **8. 飲食管理** | 進入子選單 | 設定哪些動物可以吃哪些飼料 |

### 健康監控子功能
| 子功能 | 說明 |
|--------|------|
| 1. 批量異常掃描 | 掃描所有動物，列出體重/食量異常 |
| 2. 高風險動物 | 列出近期異常狀態的動物 |
| 3. 動物趨勢 | 查詢單一動物歷史資料 |
| 4. 待處理健康警示 | 查看/確認異常輸入 (真實問題 or 輸入錯誤) |

---

## 特色功能展示

### 1. 證照權限控管
```
Admin 登入 → 指派工作 → 選擇 E002 (只有 Penguin 證照) 
→ 選擇需要 Carnivore 的動物 → 顯示「缺乏所需證照」
```

### 2. 異常檢測流程
```
User 輸入異常數據 → 記錄到 health_alerts
→ Admin 健康監控 → 待處理健康警示 → 確認是輸入錯誤
→ 自動移到 careless_logs + 刪除 health_alerts
```

### 3. 長連線展示
```
Server 終端機會顯示：
[CONNECTED] ('127.0.0.1', xxxxx) - E003 (李建宏)
[ONLINE] 目前上線人數: 1
[REQUEST] E003: add_feeding_record
```

### 4. Lock 機制展示 (選用)
```
開兩個終端機同時執行 client.py，
用同一員工同時對同一動物進行餵食操作，
觀察併發控制機制如何防止競態條件。
```

---

## 快速展示流程 (10-15 分鐘)

### Phase 1: 登入展示 (1 分鐘)
```
啟動 client → 輸入 f 查詢密碼 → 輸入 E003 → 顯示密碼 zoo123
→ 用 E003 + zoo123 登入
```

### Phase 2: User 操作 (4 分鐘)
```
查詢班表 (看今日負責動物)
→ 新增餵食 (選動物 → 選飼料 → 輸入數量)
→ 新增身體資訊 (選動物 → 輸入體重 → 選狀態)
→ 輸入異常體重展示警告功能
→ 登出
```

### Phase 3: Admin 操作 (5 分鐘)
```
用 E001 登入
→ 健康監控 → 批量異常掃描 (展示異常檢測)
→ 健康監控 → 待處理健康警示 (處理剛才的異常)
→ 庫存管理 → 報表 (看庫存) → 進貨
→ 稽核日誌 (展示 MongoDB 紀錄)
→ 冒失鬼名單
→ 登出
```

### Phase 4: 權限展示 (2 分鐘)
```
用 E001 登入
→ 指派工作 → 選 E002 → 選需要 Carnivore 的動物
→ 顯示證照不足 (權限控管成功)
```

---

## 證照對應表

| 證照 | 動物類型 | 員工 |
|------|---------|------|
| Carnivore | Lion, Tiger, Brown Bear | E001, E003, E004, E006 |
| Penguin | Penguin | E002, E003, E006, E010, E015 |
| Endangered | Koala, Panda 等珍稀動物 | E001, E004, E005, E007... |
| (無需證照) | Elephant, Giraffe 等一般動物 | 所有員工 |

---

## 異常檢測演算法

### 體重異常判定
- 近 7 天有 3+ 筆資料：使用移動平均，變化超過 15% 為異常
- 資料不足：與上次紀錄比較，變化超過 20% 為異常

### 食量異常判定
- 近 7 天有 3+ 筆資料：與近期平均比較，偏差超過 50% 為異常
- 資料不足：與歷史平均比較

---

## 備註

- PostgreSQL 資料庫名稱：`zoo_db`
- MongoDB 資料庫名稱：`zoo_nosql`
- 若展示日期值班資料過期，需更新 `employee_shift` 表
- 重置資料庫：`psql zoo_db < zoo.backup`
- 重置 MongoDB：使用 `mongo_backup.json` 重新匯入
